{"ast":null,"code":"import _regeneratorRuntime from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _createForOfIteratorHelper from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import*as d3 from'd3';import{useEffect,useState,useRef}from\"react\";import{RADIUS,drawNetwork}from'./drawNetwork';import React from'react';import ForceUndirectedD3Graph from'./ForceUndirectedD3Graph';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function DatasetDiscoveryExplainedSVGGraph_v2(_ref){var kbUri=_ref.kbUri,termInfo=_ref.termInfo,width=_ref.width,height=_ref.height;var prefix2uri={'skos:':'http://www.w3.org/2004/02/skos/core#','sosa:':'http://www.w3.org/ns/sosa/','ucmm:':'http://purl.org/ucmm#','rdf:':'http://www.w3.org/1999/02/22-rdf-syntax-ns#','dcat:':'http://www.w3.org/ns/dcat#','dcterms:':'http://purl.org/dc/terms/','i1:':'http://example.org/b2a5ed57-5c4e-4596-b803-d2ac7f5b9991#','i2:':'http://example.org/51824c86-ae0f-442f-9df2-e86244984ba3#','i3:':'http://example.org/97b4842b-94b3-4205-8781-476813d8177b#','i4:':'http://example.org/e747d804-a5d1-4fd1-bd9b-306a8ebd4904#','i5:':'http://example.org/de5b570a-b560-4e84-a755-52c2aa499874#','i6:':'http://example.org/3df904de-e47d-4bf9-85a0-7c0942aff8b6#','i7:':'http://example.org/BDML_TCHR#','i8:':'http://example.org/4f676524-a831-41fe-9afb-d95f4e7597e3#','i9:':'http://example.org/f4968943-ad6f-4563-a737-58fe3285fb3c#','i10:':'http://example.org/17e24931-ccd6-4de0-a01c-9ffb3be88461#'};function getPrefixFromUri(resourceUri){// console.log(`getPrefixFromUri(resourceUri: ', ${resourceUri})`);\nvar prefix='';Object.entries(prefix2uri).map(function(_ref2){var _ref3=_slicedToArray(_ref2,2),prefixKey=_ref3[0],uri=_ref3[1];if(resourceUri.includes(uri)){// console.log(` resourceUri.includes(${uri})`);\nprefix=prefixKey;return;// exit map function\n}});// console.log(` prefix: ', ${prefix}`);\nreturn prefix;}function getPrefixedUri(resourceUri){// console.log(`getPrefixedUri(resourceUri: ', ${resourceUri})`);\nvar prefix=getPrefixFromUri(resourceUri);if(prefix==='')return resourceUri;var prefixUri=prefix2uri[prefix];var prefixedUri=resourceUri.replace(prefixUri,prefix);// console.log(` prefixedUri: ', ${prefixedUri}`);\nreturn prefixedUri;}var prefix2group={// THEAI ODATIS FORMATER AERIS\n'i1:':1,'i2:':1,'i3:':1,'i4:':2,'i5:':2,'i6:':2,'i7:':3,'i8:':3,'i9:':3,'i10:':3,'skos:':5,'sosa:':6,'ucmm:':7,'rdf:':8,'dcat:':9,'dcterms:':10};function getGroupFromPrefixedUri(prefixedUri){var prefix=prefixedUri.substring(0,prefixedUri.indexOf(\":\")+1);if(prefix2group[prefix]){return prefix2group[prefix];}else{return 4;}}var _useState=useState({nodes:[// {\n//     id: String,\n//     group:Int32Array,\n// }\n],links:[// {\n//     source: String,\n//     target: String,\n//     value: Int16Array\n// }\n]}),_useState2=_slicedToArray(_useState,2),d3Graph=_useState2[0],setD3Graph=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),currentlyExplainedTerm=_useState4[0],setCurrentlyExplainedTerm=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),currentlyVisualisedTerm=_useState6[0],setCurrentlyVisualisedTerm=_useState6[1];function xQueryDatasetsFromDescAndTitle(){console.log(\"xQueryDatasetsFromDescAndTitle\");return\"PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\\n        PREFIX sosa: <http://www.w3.org/ns/sosa/>\\n        PREFIX ucmm: <http://purl.org/ucmm#> \\n        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \\n        PREFIX dcat: <http://www.w3.org/ns/dcat#> \\n        PREFIX dcterms: <http://purl.org/dc/terms/> \\n        SELECT DISTINCT ?dataset ?datasetProp ?litMentioningSearchLabel\\n        WHERE{\\n          VALUES ?datasetProp {dcterms:description dcterms:title}\\n          ?dataset rdf:type dcat:Dataset . \\n          ?dataset ?datasetProp ?litMentioningSearchLabel. \\n          FILTER ( \\n            regex(?litMentioningSearchLabel,\\\"\".concat(termInfo.term,\"\\\",\\\"i\\\") \\n          )\\n          FILTER (\\n            lang(?litMentioningSearchLabel)=\\\"en\\\"\\n          )\\n        }\").replace('\\n',' ');}function xQueryDatasetsFromObsCol(term){console.log(\"xQueryDatasetsFromObsCol\");// # ?obsCollDatasetProp {ucmm:hasAggregatedResult}\n// # ?obsCollProp (sosa:hasFeatureofInterest|sosa:hasUltimateFeatureofInterest|sosa:observedProperty)\nreturn\"PPREFIX skos: <http://www.w3.org/2004/02/skos/core#> \\n        PREFIX sosa: <http://www.w3.org/ns/sosa/> \\n        PREFIX ucmm: <http://purl.org/ucmm#> \\n        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \\n        PREFIX dcat: <http://www.w3.org/ns/dcat#> \\n        PREFIX dcterms: <http://purl.org/dc/terms/> \\n        SELECT DISTINCT ?dataset ?obsCollDatasetProp ?obsColl ?obsCollProp ?skosConcept ?litMentioningSearchLabel\\n        WHERE{\\n            VALUES ?obsCollDatasetProp {ucmm:hasAggregatedResult}\\n            ?dataset rdf:type dcat:Dataset .\\n            ?obsColl ?obsCollDatasetProp ?dataset .\\n            ?obsColl  ?obsCollProp ?skosConcept. \\n            ?skosConcept skos:prefLabel ?litMentioningSearchLabel . \\n          FILTER ( \\n            regex(?litMentioningSearchLabel,\\\"\".concat(term,\"\\\",\\\"i\\\") \\n          )\\n          FILTER (\\n            lang(?litMentioningSearchLabel)=\\\"en\\\"\\n          )\\n        }\").replace('\\n',' ');}function containId(nodes,searchId){var _iterator=_createForOfIteratorHelper(nodes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var node=_step.value;if(node.id===searchId){return true;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return false;}function explainDatasetsFromDescAndTitle(_x){return _explainDatasetsFromDescAndTitle.apply(this,arguments);}// const svgRef = useRef(null);\n// The force simulation mutates links and nodes, so create a copy first\n// Node positions are initialized by d3\n// let links= d3Graph.links.map((d) => ({ ...d }));\n// let nodes= d3Graph.nodes.map((d) => ({ ...d }));\nfunction _explainDatasetsFromDescAndTitle(){_explainDatasetsFromDescAndTitle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(tmpD3Graph){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(resolve,reject){var queryTxt,response,jsonData,subjects,properties,objects;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;if(!termInfo.term){resolve(false);}console.log('explainDatasetsFromDescAndTitle()');console.log(' kbUri : ',kbUri);console.log(' termInfo.term : ',termInfo.term);console.log(' tmpD3Graph: ',tmpD3Graph);queryTxt=xQueryDatasetsFromDescAndTitle();_context.next=9;return fetch(kbUri,{method:\"POST\",credentials:\"same-origin\",headers:{\"Content-Type\":'application/x-www-form-urlencoded',\"xhrFields\":{withCredentials:true},\"Accept\":\"application/json\"},redirect:\"follow\",referrerPolicy:\"no-referrer\",body:\"query=\"+queryTxt});case 9:response=_context.sent;_context.next=12;return response.json();case 12:jsonData=_context.sent;console.log(' jsonData:',jsonData);subjects=[];properties=[];objects=[];if(jsonData){if(jsonData.results){if(jsonData.results.bindings){if(jsonData.results.bindings.length>0){jsonData.results.bindings.map(function(binding){var datasetNodeId=getPrefixedUri(binding['dataset']['value']);var datasetProp=getPrefixedUri(binding['datasetProp']['value']);var datasetPropNodeId=datasetNodeId.substring(0,datasetNodeId.indexOf(\":\")+1)+datasetProp.substring(datasetProp.indexOf(\":\")+1);var litMentioningSearchLabel=binding['litMentioningSearchLabel']['value'];if(!containId(tmpD3Graph.nodes,datasetNodeId)){tmpD3Graph.nodes.push({id:datasetNodeId,group:getGroupFromPrefixedUri(datasetNodeId)});}if(!tmpD3Graph.nodes.includes(datasetPropNodeId)){tmpD3Graph.nodes.push({id:datasetPropNodeId,group:getGroupFromPrefixedUri(datasetPropNodeId)});}tmpD3Graph.links.push({source:tmpD3Graph.nodes[0].id,target:datasetPropNodeId,value:1});tmpD3Graph.links.push({source:datasetNodeId,target:datasetPropNodeId,value:1});});}}}}console.log('tmpD3Graph:',tmpD3Graph);resolve(true);_context.next=26;break;case 22:_context.prev=22;_context.t0=_context[\"catch\"](0);console.log('Error:',_context.t0);resolve(false);case 26:case\"end\":return _context.stop();}},_callee,null,[[0,22]]);}));return function(_x2,_x3){return _ref4.apply(this,arguments);};}()));case 1:case\"end\":return _context2.stop();}},_callee2);}));return _explainDatasetsFromDescAndTitle.apply(this,arguments);}useEffect(function(){console.log(\"useEffect DatasetDiscoveryExplainedSVGGraph\");console.log(\" termInfo.term\",termInfo.term);console.log(\" currentExlainedTerm\",currentlyExplainedTerm);console.log(\" currentlyVisualisedTerm\",currentlyVisualisedTerm);console.log(\" d3Graph\",d3Graph);if(termInfo.term===''){return;}if(d3Graph.nodes.length===0||termInfo.term!=currentlyExplainedTerm){var tmpD3Graph={nodes:[{id:'searchTerm',group:4}],links:[// {\n//     source: String,\n//     target: String,\n//     value: Int16Array\n// }\n]};var updatedExplanation=false;explainDatasetsFromDescAndTitle(tmpD3Graph).then(function(explanationReceived){updatedExplanation||(updatedExplanation=explanationReceived);if(updatedExplanation){setD3Graph(tmpD3Graph);setCurrentlyExplainedTerm(termInfo.term);}console.log(\" updatedExplanation: \".concat(updatedExplanation));});// NOTE that since explainDatasetsFromDescAndTitle is asynchonous the main process may return before reaching the end of explainDatasetsFromDescAndTitle\nif(currentlyVisualisedTerm!==''){if(d3.selectAll('g')){d3.selectAll('g').remove();console.log(\"  d3.selectAll('g').remove()\");}}return;}if(d3Graph.nodes.length>0&&(currentlyVisualisedTerm===''||currentlyExplainedTerm!==currentlyVisualisedTerm)){// Set the position attributes of links and nodes each time the simulation ticks.\nvar ticked=function ticked(){link.attr(\"x1\",function(d){return d.source.x;})// DatasetDiscoveryExplainedSVGGraph.js:364 Uncaught TypeError: Cannot read properties of undefined (reading 'attr')\n.attr(\"y1\",function(d){return d.source.y;}).attr(\"x2\",function(d){return d.target.x;}).attr(\"y2\",function(d){return d.target.y;});node// .attr(\"cx\", d => d.x)\n// .attr(\"cy\", d => d.y);\n.attr(\"transform\",function(d){return\"translate(\"+d.x+\",\"+d.y+\")\";});};// Reheat the simulation when drag starts, and fix the subject position.\nvar dragstarted=function dragstarted(event){if(!event.active)simulation.alphaTarget(0.3).restart();event.subject.fx=event.subject.x;event.subject.fy=event.subject.y;};// Update the subject (dragged node) position during drag.\nvar dragged=function dragged(event){event.subject.fx=event.x;event.subject.fy=event.y;};// Restore the target alpha so the simulation cools after dragging ends.\n// Unfix the subject position now that it’s no longer being dragged.\nvar dragended=function dragended(event){if(!event.active)simulation.alphaTarget(0);event.subject.fx=null;event.subject.fy=null;};// When this cell is re-run, stop the previous simulation. (This doesn’t\n// really matter since the target alpha is zero and the simulation will\n// stop naturally, but it’s a good practice.)\n//  simulation.stop();\nconsole.log(\" draw d3Graph \",d3Graph);// Specify the color scale. or schemePaired for 12 colors\nvar color=d3.scaleOrdinal(d3.schemeCategory10);// The force simulation mutates links and nodes, so create a copy\n// so that re-evaluating this cell produces the same result.\nvar links=d3Graph.links.map(function(d){return Object.create(d);});var nodes=d3Graph.nodes.map(function(d){return Object.create(d);});// Create a simulation with several forces.\nvar simulation=d3.forceSimulation(nodes).force(\"link\",d3.forceLink(links).id(function(d){return d.id;})).force(\"charge\",d3.forceManyBody()).force(\"center\",d3.forceCenter(width/2,height/2)).force(\"collide\",d3.forceCollide().radius(30).strength(1))// distance between node\n.on(\"tick\",ticked);// Create the SVG container.\nvar svg=d3.select(\"svg\").attr(\"width\",width).attr(\"height\",height).attr(\"viewBox\",[0,0,width,height]).attr(\"style\",\"max-width: 100%; height: auto;\");// Add a line for each link, and a circle for each node.\nvar link=svg.append(\"g\").attr(\"stroke\",\"#999\").attr(\"stroke-opacity\",0.6).selectAll(\"line\").data(links).join(\"line\").attr(\"stroke-width\",function(d){return Math.sqrt(d.value);});var node=svg.append(\"g\").attr(\"stroke\",\"#fff\").attr(\"stroke-width\",1.5).selectAll(\".node\").data(nodes).join(\"g\").attr('class','node');node.append(\"circle\").attr(\"r\",function(d){d.id.includes('description')?5:10;}).attr(\"fill\",function(d){return color(d.group);});// Add a drag behavior.\nnode.call(d3.drag().on(\"start\",dragstarted).on(\"drag\",dragged).on(\"end\",dragended));// node.append(\"title\")\n//     .text(d => d.id)\n//     .style('font-family', 'sans-serif')\n//     .style('font-size', '16px')\n//     .attr('x', 11)\n//     .attr('y', 3);\nnode.append(\"text\").text(function(d){return d.id;})// .style('fill', '#000')\n// .style('stroke', '#000')\n// .style('stroke-width', 0.5)\n.style('fontSize',16).style('color','grey')// .style('font-size', '14px')\n.attr(\"text-anchor\",\"start\").attr('x',11).attr('y',3);simulation.nodes(nodes).on(\"tick\",ticked);simulation.force(\"link\").links(links);setCurrentlyVisualisedTerm(currentlyExplainedTerm);}},[termInfo,d3Graph]// nodes, links\n);return/*#__PURE__*/_jsx(\"div\",{children:d3Graph.nodes.length>0?/*#__PURE__*/_jsx(\"svg\",{id:\"svg\"// ref={svgRef}\n,style:{width:width,height:height},width:width,height:height}):/*#__PURE__*/_jsx(_Fragment,{})});}","map":{"version":3,"names":["d3","useEffect","useState","useRef","RADIUS","drawNetwork","React","ForceUndirectedD3Graph","jsx","_jsx","Fragment","_Fragment","DatasetDiscoveryExplainedSVGGraph_v2","_ref","kbUri","termInfo","width","height","prefix2uri","getPrefixFromUri","resourceUri","prefix","Object","entries","map","_ref2","_ref3","_slicedToArray","prefixKey","uri","includes","getPrefixedUri","prefixUri","prefixedUri","replace","prefix2group","getGroupFromPrefixedUri","substring","indexOf","_useState","nodes","links","_useState2","d3Graph","setD3Graph","_useState3","_useState4","currentlyExplainedTerm","setCurrentlyExplainedTerm","_useState5","_useState6","currentlyVisualisedTerm","setCurrentlyVisualisedTerm","xQueryDatasetsFromDescAndTitle","console","log","concat","term","xQueryDatasetsFromObsCol","containId","searchId","_iterator","_createForOfIteratorHelper","_step","s","n","done","node","value","id","err","e","f","explainDatasetsFromDescAndTitle","_x","_explainDatasetsFromDescAndTitle","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","tmpD3Graph","wrap","_callee2$","_context2","prev","next","abrupt","Promise","_ref4","_callee","resolve","reject","queryTxt","response","jsonData","subjects","properties","objects","_callee$","_context","fetch","method","credentials","headers","withCredentials","redirect","referrerPolicy","body","sent","json","results","bindings","length","binding","datasetNodeId","datasetProp","datasetPropNodeId","litMentioningSearchLabel","push","group","source","target","t0","stop","_x2","_x3","updatedExplanation","then","explanationReceived","selectAll","remove","ticked","link","attr","d","x","y","dragstarted","event","active","simulation","alphaTarget","restart","subject","fx","fy","dragged","dragended","color","scaleOrdinal","schemeCategory10","create","forceSimulation","force","forceLink","forceManyBody","forceCenter","forceCollide","radius","strength","on","svg","select","append","data","join","Math","sqrt","call","drag","text","style","children"],"sources":["/home/vincentarmant/workspace/nodejs/react-restapi-call/src/components/DatasetDiscoveryExplainedSVGGraph_v2.js"],"sourcesContent":["import * as d3 from 'd3';\nimport { useEffect, useState, useRef } from \"react\";\nimport { RADIUS, drawNetwork } from './drawNetwork';\nimport React from 'react';\nimport ForceUndirectedD3Graph from './ForceUndirectedD3Graph';\n\n\n\nexport default function DatasetDiscoveryExplainedSVGGraph_v2 ({kbUri, termInfo, width, height}){\n\n    const prefix2uri = {\n        'skos:':'http://www.w3.org/2004/02/skos/core#',\n        'sosa:': 'http://www.w3.org/ns/sosa/',\n        'ucmm:':'http://purl.org/ucmm#',\n        'rdf:': 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\n        'dcat:':'http://www.w3.org/ns/dcat#',\n        'dcterms:':'http://purl.org/dc/terms/',\n\n        'i1:':'http://example.org/b2a5ed57-5c4e-4596-b803-d2ac7f5b9991#',\n        'i2:':'http://example.org/51824c86-ae0f-442f-9df2-e86244984ba3#',\n        'i3:':'http://example.org/97b4842b-94b3-4205-8781-476813d8177b#',\n        'i4:':'http://example.org/e747d804-a5d1-4fd1-bd9b-306a8ebd4904#',\n        'i5:': 'http://example.org/de5b570a-b560-4e84-a755-52c2aa499874#',\n        'i6:': 'http://example.org/3df904de-e47d-4bf9-85a0-7c0942aff8b6#',\n        'i7:': 'http://example.org/BDML_TCHR#',\n        'i8:': 'http://example.org/4f676524-a831-41fe-9afb-d95f4e7597e3#',\n        'i9:': 'http://example.org/f4968943-ad6f-4563-a737-58fe3285fb3c#',\n        'i10:': 'http://example.org/17e24931-ccd6-4de0-a01c-9ffb3be88461#'\n    };\n\n    function getPrefixFromUri(resourceUri){\n\n        // console.log(`getPrefixFromUri(resourceUri: ', ${resourceUri})`);\n\n        let prefix = '';\n        Object.entries(prefix2uri).map( ([prefixKey,uri]) => {\n            if(resourceUri.includes(uri)){\n                // console.log(` resourceUri.includes(${uri})`);\n                prefix = prefixKey;\n                return; // exit map function\n            }\n        })\n\n        // console.log(` prefix: ', ${prefix}`);\n\n        return prefix;\n    }\n    \n    function getPrefixedUri(resourceUri){\n\n        // console.log(`getPrefixedUri(resourceUri: ', ${resourceUri})`);\n\n        const prefix = getPrefixFromUri(resourceUri);\n\n        if(prefix==='')\n            return resourceUri;\n\n        const prefixUri = prefix2uri[prefix];\n        const prefixedUri = resourceUri.replace(prefixUri,prefix);\n\n        // console.log(` prefixedUri: ', ${prefixedUri}`);\n\n        return prefixedUri;\n    }\n\n    const prefix2group ={ // THEAI ODATIS FORMATER AERIS\n        'i1:': 1,\n        'i2:': 1,\n        'i3:': 1,\n        'i4:': 2,\n        'i5:': 2,\n        'i6:': 2,\n        'i7:': 3,\n        'i8:': 3,\n        'i9:': 3,\n        'i10:': 3,\n\n        'skos:':5,\n        'sosa:':6,\n        'ucmm:':7,\n        'rdf:': 8,\n        'dcat:':9,\n        'dcterms:':10\n    }\n\n    function getGroupFromPrefixedUri(prefixedUri){\n        const prefix= prefixedUri.substring(0,prefixedUri.indexOf(\":\")+1)\n\n        \n        if(prefix2group[prefix]){\n            return prefix2group[prefix];\n        }else{\n            return 4;\n        }\n    }\n\n\n    const [d3Graph,setD3Graph]= useState({\n        nodes:[\n            // {\n            //     id: String,\n            //     group:Int32Array,\n            // }\n        ],\n        links:[\n            // {\n            //     source: String,\n            //     target: String,\n            //     value: Int16Array\n            // }\n        ]\n    });\n\n    const [currentlyExplainedTerm, setCurrentlyExplainedTerm] = useState('');\n    const [currentlyVisualisedTerm, setCurrentlyVisualisedTerm] = useState('');\n\n \n\n    function xQueryDatasetsFromDescAndTitle(){\n\n        console.log(`xQueryDatasetsFromDescAndTitle`);\n\n        return (`PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n        PREFIX sosa: <http://www.w3.org/ns/sosa/>\n        PREFIX ucmm: <http://purl.org/ucmm#> \n        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \n        PREFIX dcat: <http://www.w3.org/ns/dcat#> \n        PREFIX dcterms: <http://purl.org/dc/terms/> \n        SELECT DISTINCT ?dataset ?datasetProp ?litMentioningSearchLabel\n        WHERE{\n          VALUES ?datasetProp {dcterms:description dcterms:title}\n          ?dataset rdf:type dcat:Dataset . \n          ?dataset ?datasetProp ?litMentioningSearchLabel. \n          FILTER ( \n            regex(?litMentioningSearchLabel,\"${termInfo.term}\",\"i\") \n          )\n          FILTER (\n            lang(?litMentioningSearchLabel)=\"en\"\n          )\n        }`).replace('\\n',' ');\n    }\n\n    function xQueryDatasetsFromObsCol(term){\n\n        console.log(`xQueryDatasetsFromObsCol`);\n\n        // # ?obsCollDatasetProp {ucmm:hasAggregatedResult}\n        // # ?obsCollProp (sosa:hasFeatureofInterest|sosa:hasUltimateFeatureofInterest|sosa:observedProperty)\n        return (`PPREFIX skos: <http://www.w3.org/2004/02/skos/core#> \n        PREFIX sosa: <http://www.w3.org/ns/sosa/> \n        PREFIX ucmm: <http://purl.org/ucmm#> \n        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \n        PREFIX dcat: <http://www.w3.org/ns/dcat#> \n        PREFIX dcterms: <http://purl.org/dc/terms/> \n        SELECT DISTINCT ?dataset ?obsCollDatasetProp ?obsColl ?obsCollProp ?skosConcept ?litMentioningSearchLabel\n        WHERE{\n            VALUES ?obsCollDatasetProp {ucmm:hasAggregatedResult}\n            ?dataset rdf:type dcat:Dataset .\n            ?obsColl ?obsCollDatasetProp ?dataset .\n            ?obsColl  ?obsCollProp ?skosConcept. \n            ?skosConcept skos:prefLabel ?litMentioningSearchLabel . \n          FILTER ( \n            regex(?litMentioningSearchLabel,\"${term}\",\"i\") \n          )\n          FILTER (\n            lang(?litMentioningSearchLabel)=\"en\"\n          )\n        }`).replace('\\n',' ');\n    }\n\n\n    function containId(nodes,searchId){\n        for(const node of nodes){\n            if( node.id === searchId){\n                return true;\n               }\n        }\n        return false;\n    }\n\n    \n    async function explainDatasetsFromDescAndTitle (tmpD3Graph) {\n        \n        return new Promise (async (resolve,reject) => {\n\n        try {  \n\n            if(!termInfo.term){\n                resolve(false);\n            }\n\n            console.log('explainDatasetsFromDescAndTitle()')\n            console.log(' kbUri : ',kbUri);\n            console.log(' termInfo.term : ',termInfo.term);\n            console.log(' tmpD3Graph: ',tmpD3Graph);\n\n            \n\n            const queryTxt = xQueryDatasetsFromDescAndTitle();\n\n            const response = await fetch(kbUri,{\n                method: \"POST\",\n                credentials: \"same-origin\",\n                headers:{\n                    \"Content-Type\": 'application/x-www-form-urlencoded',\n                    \"xhrFields\": {withCredentials: true},\n                    \"Accept\" : \"application/json\",\n                },\n                redirect: \"follow\",\n                referrerPolicy: \"no-referrer\",\n                body: \"query=\"+ queryTxt\n            }\n            )            \n            \n            const jsonData = await response.json();\n            \n            console.log(' jsonData:', jsonData);\n            \n            let subjects= [];\n            let properties = [];\n            let objects = [];\n\n            \n\n            if(jsonData){\n\n                if(jsonData.results){\n                    if(jsonData.results.bindings){\n                        if(jsonData.results.bindings.length>0){\n\n                            jsonData.results.bindings.map( binding =>{\n                                const datasetNodeId =  getPrefixedUri(binding['dataset']['value']);\n                                const datasetProp = getPrefixedUri(binding['datasetProp']['value']);\n\n                                const datasetPropNodeId = datasetNodeId.substring(0,datasetNodeId.indexOf(\":\")+1)\n                                + datasetProp.substring(datasetProp.indexOf(\":\")+1);\n\n                                const litMentioningSearchLabel= binding['litMentioningSearchLabel']['value'];\n\n                                if(!containId(tmpD3Graph.nodes,datasetNodeId)){\n                                    tmpD3Graph.nodes.push({\n                                        id: datasetNodeId,\n                                        group: getGroupFromPrefixedUri(datasetNodeId)\n                                    });\n                                }\n\n                                if(!tmpD3Graph.nodes.includes(datasetPropNodeId)){\n                                    tmpD3Graph.nodes.push({\n                                        id: datasetPropNodeId,\n                                        group: getGroupFromPrefixedUri(datasetPropNodeId)\n                                    });\n                                }\n\n                                tmpD3Graph.links.push({\n                                    source: tmpD3Graph.nodes[0].id,\n                                    target: datasetPropNodeId,\n                                    value: 1\n                                })\n\n                                tmpD3Graph.links.push({\n                                    source: datasetNodeId,\n                                    target: datasetPropNodeId,\n                                    value: 1\n                                })\n\n                                \n                            })\n                        }\n                    }\n                }\n\n            }\n\n            console.log('tmpD3Graph:', tmpD3Graph);\n           resolve(true);\n             \n        } catch (error) {\n            console.log('Error:', error);\n            resolve(false);\n        }\n        })\n    }\n\n    // const svgRef = useRef(null);\n\n    // The force simulation mutates links and nodes, so create a copy first\n    // Node positions are initialized by d3\n    // let links= d3Graph.links.map((d) => ({ ...d }));\n    // let nodes= d3Graph.nodes.map((d) => ({ ...d }));\n\n    useEffect( function () {\n\n\n            console.log(`useEffect DatasetDiscoveryExplainedSVGGraph`)\n            console.log(` termInfo.term`,termInfo.term)\n            console.log(` currentExlainedTerm`, currentlyExplainedTerm )\n            console.log(` currentlyVisualisedTerm`, currentlyVisualisedTerm )\n\n            console.log(` d3Graph`,d3Graph)\n\n            if(termInfo.term === '' ){\n                return;\n            }\n               \n\n            if(d3Graph.nodes.length===0 || termInfo.term != currentlyExplainedTerm ){\n\n                const tmpD3Graph = {\n                    nodes:[\n                        {\n                            id:'searchTerm',\n                            group:4,\n                        }\n                    ],\n                    links:[\n                        // {\n                        //     source: String,\n                        //     target: String,\n                        //     value: Int16Array\n                        // }\n                    ]\n                };\n                \n                let updatedExplanation = false;\n                explainDatasetsFromDescAndTitle(tmpD3Graph).then( (explanationReceived) =>{\n                    \n                    updatedExplanation ||=  explanationReceived;\n\n                    if(updatedExplanation){\n                        setD3Graph(tmpD3Graph);\n                        setCurrentlyExplainedTerm(termInfo.term);\n                    }\n\n\n                    console.log(` updatedExplanation: ${updatedExplanation}`)\n                })\n\n                // NOTE that since explainDatasetsFromDescAndTitle is asynchonous the main process may return before reaching the end of explainDatasetsFromDescAndTitle\n                if(currentlyVisualisedTerm!==''){\n                    if(d3.selectAll('g')){\n                        d3.selectAll('g').remove();\n                        console.log(`  d3.selectAll('g').remove()`);\n                    }\n                }\n\n                return;\n\n            }\n            \n            if(d3Graph.nodes.length>0 && (currentlyVisualisedTerm==='' || currentlyExplainedTerm !== currentlyVisualisedTerm )){\n\n                console.log(` draw d3Graph `,d3Graph);\n\n\n                \n                \n                 // Specify the color scale. or schemePaired for 12 colors\n                const color = d3.scaleOrdinal(d3.schemeCategory10);\n\n                // The force simulation mutates links and nodes, so create a copy\n                // so that re-evaluating this cell produces the same result.\n                const links = d3Graph.links.map(d => (Object.create(d)));\n                const nodes = d3Graph.nodes.map(d => (Object.create(d)));\n\n                \n                \n                // Create a simulation with several forces.\n                const simulation = d3.forceSimulation(nodes)\n                    .force(\"link\", d3.forceLink(links).id(d => d.id))\n                    .force(\"charge\", d3.forceManyBody())\n                    .force(\"center\", d3.forceCenter(width / 2, height / 2))\n                    .force(\"collide\", d3.forceCollide().radius(30).strength(1) ) // distance between node\n                    .on(\"tick\", ticked);\n\n                // Create the SVG container.\n                const svg = d3.select(\"svg\")\n                    .attr(\"width\", width)\n                    .attr(\"height\", height)\n                    .attr(\"viewBox\", [0, 0, width, height])\n                    .attr(\"style\", \"max-width: 100%; height: auto;\")\n                ;\n\n\n                // Add a line for each link, and a circle for each node.\n                const link = svg.append(\"g\")\n                    .attr(\"stroke\", \"#999\")\n                    .attr(\"stroke-opacity\", 0.6)\n                    .selectAll(\"line\")\n                    .data(links)\n                    .join(\"line\")\n                    .attr(\"stroke-width\", d => Math.sqrt(d.value));\n\n                const node = svg.append(\"g\")\n                    .attr(\"stroke\", \"#fff\")\n                    .attr(\"stroke-width\", 1.5)\n                    .selectAll(\".node\")\n                    .data(nodes)\n                    .join(\"g\")\n                    .attr('class', 'node');\n                \n                node.append(\"circle\")\n                    .attr(\"r\", d =>{ d.id.includes('description')?5:10})\n                    .attr(\"fill\", d => color(d.group));\n\n                // Add a drag behavior.\n                node.call(d3.drag()\n                    .on(\"start\", dragstarted)\n                    .on(\"drag\", dragged)\n                    .on(\"end\", dragended));\n\n\n                // node.append(\"title\")\n                //     .text(d => d.id)\n                //     .style('font-family', 'sans-serif')\n                //     .style('font-size', '16px')\n                //     .attr('x', 11)\n                //     .attr('y', 3);\n\n                node.append(\"text\")\n                    .text(d => d.id)\n                    // .style('fill', '#000')\n                    // .style('stroke', '#000')\n                    // .style('stroke-width', 0.5)\n                    .style('fontSize', 16)\n                    .style('color', 'grey')\n                    // .style('font-size', '14px')\n                    .attr(\"text-anchor\",\"start\")\n                    .attr('x', 11)\n                    .attr('y', 3);\n\n                simulation\n                    .nodes(nodes)\n                    .on(\"tick\", ticked);\n              \n                simulation.force(\"link\")\n                    .links(links);\n                   \n\n                \n\n                // Set the position attributes of links and nodes each time the simulation ticks.\n                function ticked() {\n                    link\n                        .attr(\"x1\", d => d.source.x) // DatasetDiscoveryExplainedSVGGraph.js:364 Uncaught TypeError: Cannot read properties of undefined (reading 'attr')\n                        .attr(\"y1\", d => d.source.y)\n                        .attr(\"x2\", d => d.target.x)\n                        .attr(\"y2\", d => d.target.y);\n\n                    node\n                        // .attr(\"cx\", d => d.x)\n                        // .attr(\"cy\", d => d.y);\n                        .attr(\"transform\", function(d) {\n                            return \"translate(\" + d.x + \",\" + d.y + \")\";\n                          })\n                }\n\n                // Reheat the simulation when drag starts, and fix the subject position.\n                function dragstarted(event) {\n                    if (!event.active) simulation.alphaTarget(0.3).restart();\n                    event.subject.fx = event.subject.x;\n                    event.subject.fy = event.subject.y;\n                }\n\n                // Update the subject (dragged node) position during drag.\n                function dragged(event) {\n                    event.subject.fx = event.x;\n                    event.subject.fy = event.y;\n                }\n\n                // Restore the target alpha so the simulation cools after dragging ends.\n                // Unfix the subject position now that it’s no longer being dragged.\n                function dragended(event) {\n                    if (!event.active) simulation.alphaTarget(0);\n                    event.subject.fx = null;\n                    event.subject.fy = null;\n                }\n\n                // When this cell is re-run, stop the previous simulation. (This doesn’t\n                // really matter since the target alpha is zero and the simulation will\n                // stop naturally, but it’s a good practice.)\n                //  simulation.stop();\n\n\n                setCurrentlyVisualisedTerm(currentlyExplainedTerm);\n\n                \n\n            }\n\n\n\n        }, [termInfo, d3Graph] // nodes, links\n    );\n\n    return(\n        <div>\n            {d3Graph.nodes.length>0?(\n                <svg id='svg'\n                    // ref={svgRef}\n                    style={{\n                        width,\n                        height\n                    }}\n                    width={width}\n                    height={height}\n                />\n            ):(\n                <></>\n            )\n            }\n        </div>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}