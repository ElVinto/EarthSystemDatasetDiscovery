{"ast":null,"code":"import _regeneratorRuntime from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/vincentarmant/workspace/nodejs/react-restapi-call/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import Table from'react-bootstrap/Table';import{Card}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function LinkedSearchDatasetVarTable(_ref){var linkedSearchPathList=_ref.linkedSearchPathList,linkedSearchLabel=_ref.linkedSearchLabel,endpointUri=_ref.endpointUri;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),varNames=_useState2[0],setVarNames=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),bindings=_useState4[0],setBindings=_useState4[1];function composeQuery(){return'PREFIX skos: <http://www.w3.org/2004/02/skos/core#> '+'PREFIX sosa: <http://www.w3.org/ns/sosa/> '+'PREFIX ucmm: <http://purl.org/ucmm#> '+'PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> '+'PREFIX dcat: <http://www.w3.org/ns/dcat#> '+'PREFIX dcterms: <http://purl.org/dc/terms/> '+'SELECT DISTINCT ?dataset '+'WHERE{ '+'  { '+'    ?dataset rdf:type dcat:Dataset . '+'    ?dataset ?p ?concept . '+// ?p matches: dcterms:subject, dcterms:theme\n'    ?concept skos:prefLabel ?searchLabel . '+// ?p matches: dcterms:subject, dcterms:theme '+\n'  }UNION{ '+'    ?dataset rdf:type dcat:Dataset . '+'    ?dataset dcterms:description|dcterms:title ?searchLabel. '+'  }UNION{ '+'    ?dataset rdf:type dcat:Dataset . '+'    ?obsColl ucmm:hasAggregatedResult ?dataset . '+'    ?obsColl  (sosa:hasFeatureofInterest|sosa:hasUltimateFeatureofInterest) ?concept . '+'    ?concept skos:prefLabel ?searchLabel . '+'  }UNION{ '+'    ?dataset rdf:type dcat:Dataset .'+'    ?obsColl ucmm:hasAggregatedResult ?dataset . '+'    ?obsColl sosa:observedProperty ?concept . '+'    ?concept skos:prefLabel ?searchLabel . '+'  }'+'  FILTER ('+'    regex(?searchLabel,\"'+linkedSearchLabel+'\",\"i\") '+'  )'+'  FILTER ('+'    lang(?searchLabel)=\"en\"'+'  )'+'}';}function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,jsonData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;console.log('endpointUri : ',endpointUri);console.log('searchLabel : ',linkedSearchLabel);console.log('composeQuery : ',composeQuery());_context.next=6;return fetch(endpointUri,{method:\"POST\",credentials:\"same-origin\",headers:{\"Content-Type\":'application/x-www-form-urlencoded',\"xhrFields\":{withCredentials:true},\"Accept\":\"application/json\"},redirect:\"follow\",referrerPolicy:\"no-referrer\",body:\"query=\"+composeQuery()});case 6:response=_context.sent;_context.next=9;return response.json();case 9:jsonData=_context.sent;console.log('jsonData:',jsonData);if(jsonData){if(jsonData.results){if(jsonData.results.bindings){setBindings(jsonData.results.bindings);}}if(jsonData.head){if(jsonData.head.vars){setVarNames(jsonData.head.vars);}}}// console.log('varNames:', varNames); \n// console.log('bindings:', bindings);\n_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.log('Error:',_context.t0);case 17:case\"end\":return _context.stop();}},_callee,null,[[0,14]]);}));return _fetchData.apply(this,arguments);}useEffect(function(){if(linkedSearchLabel!==''){fetchData();}},[linkedSearchLabel]);return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:linkedSearchPathList.length>0?/*#__PURE__*/_jsx(\"ul\",{children:linkedSearchPathList.map(function(linkedSearchPath){/*#__PURE__*/_jsx(\"li\",{children:linkedSearchPath});})}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsx(Card.Body,{children:varNames.length>0?/*#__PURE__*/_jsxs(Table,{striped:true,bordered:true,hover:true,responsive:true,size:\"lg\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsx(\"tr\",{\"text-align\":\"center\",children:varNames.map(function(v){return/*#__PURE__*/_jsxs(\"th\",{children:[\" \",\"\".concat(v,\"(s)\"),\" \"]});})})}),/*#__PURE__*/_jsx(\"tbody\",{children:bindings.map(function(binding){return/*#__PURE__*/_jsx(\"tr\",{children:varNames.map(function(varName){return/*#__PURE__*/_jsxs(\"td\",{children:[\" \",binding[varName][\"value\"],\" \"]});})});})})]}):/*#__PURE__*/_jsx(\"p\",{children:\" Data not loaded yet ... \"})})]});}","map":{"version":3,"names":["useState","useEffect","Table","Card","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","LinkedSearchDatasetVarTable","_ref","linkedSearchPathList","linkedSearchLabel","endpointUri","_useState","_useState2","_slicedToArray","varNames","setVarNames","_useState3","_useState4","bindings","setBindings","composeQuery","fetchData","_fetchData","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","jsonData","wrap","_callee$","_context","prev","next","console","log","fetch","method","credentials","headers","withCredentials","redirect","referrerPolicy","body","sent","json","results","head","vars","t0","stop","children","Header","length","map","linkedSearchPath","Body","striped","bordered","hover","responsive","size","v","concat","binding","varName"],"sources":["/home/vincentarmant/workspace/nodejs/react-restapi-call/src/components/bindingVarTable/LinkedSearchDatasetVarTable.js"],"sourcesContent":["import {useState,useEffect} from 'react'\nimport Table from 'react-bootstrap/Table';\nimport { Card } from 'react-bootstrap';\n\nexport default function LinkedSearchDatasetVarTable({linkedSearchPathList, linkedSearchLabel, endpointUri}){\n\n    const [varNames,setVarNames] = useState([]);\n    const [bindings, setBindings] = useState([]);\n\n    \n\n    function composeQuery(){\n        return 'PREFIX skos: <http://www.w3.org/2004/02/skos/core#> '+\n            'PREFIX sosa: <http://www.w3.org/ns/sosa/> '+\n            'PREFIX ucmm: <http://purl.org/ucmm#> '+\n            'PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> '+\n            'PREFIX dcat: <http://www.w3.org/ns/dcat#> '+\n            'PREFIX dcterms: <http://purl.org/dc/terms/> '+\n            'SELECT DISTINCT ?dataset '+\n            'WHERE{ '+\n            '  { '+\n            '    ?dataset rdf:type dcat:Dataset . '+\n            '    ?dataset ?p ?concept . '+ // ?p matches: dcterms:subject, dcterms:theme\n            '    ?concept skos:prefLabel ?searchLabel . '+ // ?p matches: dcterms:subject, dcterms:theme '+\n            '  }UNION{ '+\n            '    ?dataset rdf:type dcat:Dataset . '+\n            '    ?dataset dcterms:description|dcterms:title ?searchLabel. '+ \n            '  }UNION{ '+\n            '    ?dataset rdf:type dcat:Dataset . '+\n            '    ?obsColl ucmm:hasAggregatedResult ?dataset . '+\n            '    ?obsColl  (sosa:hasFeatureofInterest|sosa:hasUltimateFeatureofInterest) ?concept . '+\n            '    ?concept skos:prefLabel ?searchLabel . '+\n            '  }UNION{ '+\n            '    ?dataset rdf:type dcat:Dataset .'+\n            '    ?obsColl ucmm:hasAggregatedResult ?dataset . '+\n            '    ?obsColl sosa:observedProperty ?concept . '+\n            '    ?concept skos:prefLabel ?searchLabel . '+\n            '  }'+\n            '  FILTER ('+ \n            '    regex(?searchLabel,\"'+linkedSearchLabel+'\",\"i\") '+\n            '  )'+\n            '  FILTER ('+ \n            '    lang(?searchLabel)=\"en\"'+\n            '  )'+\n            '}'\n    }\n\n    async function fetchData ()   {\n\n        try {  \n\n            console.log('endpointUri : ',endpointUri);\n            console.log('searchLabel : ',linkedSearchLabel);\n\n            console.log('composeQuery : ',composeQuery());\n\n            const response = await fetch(endpointUri,{\n                method: \"POST\",\n                credentials: \"same-origin\",\n                headers:{\n                    \"Content-Type\": 'application/x-www-form-urlencoded',\n                    \"xhrFields\": {withCredentials: true},\n                    \"Accept\" : \"application/json\",\n                },\n                redirect: \"follow\",\n                referrerPolicy: \"no-referrer\",\n                body: \"query=\"+ composeQuery()\n            }\n            )            \n            \n            const jsonData = await response.json();\n            \n            console.log('jsonData:', jsonData);\n            \n            if(jsonData){\n\n                if(jsonData.results){\n                    if(jsonData.results.bindings){\n                        setBindings(jsonData.results.bindings);\n                    }}\n\n                if(jsonData.head){\n                    if(jsonData.head.vars){\n                        setVarNames(jsonData.head.vars);\n                    }\n                }\n                \n            }\n\n            // console.log('varNames:', varNames); \n            // console.log('bindings:', bindings);\n\n        } catch (error) {\n            console.log('Error:', error);\n            \n        }\n    }\n\n    useEffect (\n         () =>{\n            if(linkedSearchLabel !== ''){\n                fetchData();\n            }\n        },\n        [linkedSearchLabel]\n    );\n\n \n    return(\n        <Card>\n            <Card.Header>\n                {linkedSearchPathList.length>0?(\n                    <ul>\n                    {\n                        linkedSearchPathList.map( (linkedSearchPath) => {<li>{linkedSearchPath}</li>})\n                    }\n                    </ul>\n                ):(\n                    <></>\n                )}\n            </Card.Header>\n            <Card.Body>\n            {varNames.length>0 ?(\n                <Table striped bordered hover responsive size='lg' >\n                    <thead >\n                        <tr text-align=\"center\">\n                            {varNames.map(v => <th> {`${v}(s)`} </th> )}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {bindings.map(binding =>\n                            <tr>\n                                {varNames.map(varName => \n                                    <td> {binding[varName][\"value\"]} </td>\n                                )}\n                            </tr>\n                        )}\n                    </tbody>\n                </Table>\n            ):(\n                <p> Data not loaded yet ... </p>\n            )}\n            </Card.Body> \n        </Card>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}